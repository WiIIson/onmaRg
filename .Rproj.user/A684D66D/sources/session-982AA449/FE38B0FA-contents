---
title: "Sunshine List Equity"
author: "Conley"
date: "20/05/2022"
output: html_document
---

## Load Data

The datasets on the public sector salary disclosure all use different naming conventions, and need to be modified to fit into a single data frame.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load libraries
library(tidyverse)


# 1996 - https://files.ontario.ca/en-1996-pssd.csv
# 1997 - https://files.ontario.ca/en-1997-pssd.csv
# 1998 - https://files.ontario.ca/en-1998-pssd.csv
# 1999 - https://files.ontario.ca/en-1999-pssd.csv
# 2000 - https://files.ontario.ca/en-2000-pssd.csv
# 2001 - https://files.ontario.ca/en-2001-pssd.csv
# 2002 - https://files.ontario.ca/en-2002-pssd.csv
# 2003 - https://files.ontario.ca/en-2003-pssd.csv
# 2004 - https://files.ontario.ca/en-2004-pssd.csv
# 2005 - https://files.ontario.ca/en-2005-pssd.csv
# 2006 - https://files.ontario.ca/en-2006-pssd.csv
# 2007 - https://files.ontario.ca/en-2007-pssd.csv
# 2008 - https://files.ontario.ca/en-2008-pssd.csv
# 2009 - https://files.ontario.ca/en-2009-pssd.csv
# 2010 - https://files.ontario.ca/2010.csv
# 2011 - https://files.ontario.ca/2011_0.csv
# 2012 - https://files.ontario.ca/pssd-en-2012-fixed_0.csv
# 2013 - https://files.ontario.ca/pssd-en-2013.csv
# 2014 - https://files.ontario.ca/2014-pssd-full-compendium-utf8-en.csv
# 2015 - https://files.ontario.ca/pssd/en-2015-pssd-compendium-with-addendum-20161219.csv
# 2016 - https://files.ontario.ca/en-2016-pssd-compendium-20171128-utf8.csv
# 2017 - https://files.ontario.ca/en-2018-pssd-compendium.csv
# 2018 - https://files.ontario.ca/en-2018-pssd-compendium-20191223.csv
# 2019 - https://files.ontario.ca/tbs-pssd-compendium-2019-en-2020-12-21.csv
# 2020 - https://files.ontario.ca/pssd/2020/tbs-pssd-compendium-2020-en-utf-8-2022-01-10.csv
# 2021 - https://www.ontario.ca/public-sector-salary-disclosure/pssd-assets/files/2021/tbs-pssd-compendium-salary-disclosed-2021-en-utf-8-2022-03-25.csv

# Import data
sunshine_data <- read.csv("https://files.ontario.ca/en-1996-pssd.csv") %>%
  select(-X) %>%
  rbind(read.csv("https://files.ontario.ca/en-1997-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-1998-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-1999-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2000-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2001-pssd.csv") %>% rename("Job.Title"="Position", "Last.Name"="Surname")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2002-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2003-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2004-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2005-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2006-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2007-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2008-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2009-pssd.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/2010.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/2011_0.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/pssd-en-2012-fixed_0.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/pssd-en-2013.csv")) %>%
  rbind(
    read.csv("https://files.ontario.ca/2014-pssd-full-compendium-utf8-en.csv") %>% rename(
      "Last.Name"="Last.name",
      "Job.Title"="Job.title",
      "Calendar.Year"="Calendar.year"
    )
  ) %>%
  rbind(read.csv("https://files.ontario.ca/pssd/en-2015-pssd-compendium-with-addendum-20161219.csv")) %>%
  rbind(
    read.csv("https://files.ontario.ca/en-2016-pssd-compendium-20171128-utf8.csv") %>%
      filter(Calendar.Year == 2016)
  ) %>%    
  rbind(read.csv("https://files.ontario.ca/en-2018-pssd-compendium.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/en-2018-pssd-compendium-20191223.csv")) %>%
  rbind(read.csv("https://files.ontario.ca/tbs-pssd-compendium-2019-en-2020-12-21.csv")) %>%
  rbind(
    read.csv("https://files.ontario.ca/pssd/2020/tbs-pssd-compendium-2020-en-utf-8-2022-01-10.csv") %>% rename(
      "Last.Name"="Last.name",
      "First.Name"="First.name",
      "Salary.Paid"="Salary",
      "Taxable.Benefits"="Benefits",
      "Job.Title"="Job.title",
      "Calendar.Year"="Year"
    )
  ) %>%
  rbind(
    read.csv("https://www.ontario.ca/public-sector-salary-disclosure/pssd-assets/files/2021/tbs-pssd-compendium-salary-disclosed-2021-en-utf-8-2022-03-25.csv") %>%
      rename("Salary.Paid"="Salary", "Taxable.Benefits"="Benefits","Calendar.Year"="Year") %>%
      select(-X_docID)
  ) %>%
  # Clean list member names
  mutate(First.Name=sapply(
    strsplit(First.Name, " "), function(x) x[which.max(nchar(x))]) %>%
      str_to_title()
  ) %>%
  # Clean list member salaries
  mutate(
    Salary.Paid=gsub(Salary.Paid, pattern="$", replacement="", fixed=TRUE) %>%
      gsub(pattern=" ", replacement="") %>%
      gsub(pattern=",", replacement="") %>%
      as.numeric()
  )

```


## Join data with gender data

```{r}

# Get the dataset of gender by name
wgnd <- read.csv("C:/Users/willi/Documents/Professional Work/wgnd.csv") %>%
  rename("First.Name"="name")

# Merge the two datasets
sunshine_gender <- merge(sunshine_data, wgnd, by="First.Name")

```


## Verify the loading

```{r}

unique(sunshine_data$Calendar.Year)

unique(sunshine_gender$Calendar.Year)

```


## Uncategorized Analysis

```{r}

# Employees per Year

sg_emp <- sunshine_data %>%
  group_by(Calendar.Year) %>%
  summarise(entries=n()) %>%
  data.frame()

ggplot(data=sg_emp, aes(x=Calendar.Year, y=entries)) +
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=-90,hjust=1,vjust=0.5)) +
  xlab("Year") +
  ylab("Employees") +
  ggtitle("Employees per Year")

```
```{r}

# Total Money Paid Out per Year

sg_sum <- sunshine_data %>%
  group_by(Calendar.Year) %>%
  summarise(entries=sum(Salary.Paid)) %>%
  data.frame()

ggplot(data=sg_sum, aes(x=Calendar.Year, y=entries)) +
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=-90,hjust=1,vjust=0.5)) +
  xlab("Year") +
  ylab("Total Money Paid") +
  ggtitle("Total Money Paid Out per Year")

```

```{r}

# Average Salary per Year

sg_avg <- sunshine_data %>%
  group_by(Calendar.Year) %>%
  summarise(entries=mean(Salary.Paid)) %>%
  data.frame()

ggplot(data=sg_avg, aes(x=Calendar.Year, y=entries)) +
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=-90,hjust=1,vjust=0.5)) +
  xlab("Year") +
  ylab("Average Salary") +
  ggtitle("Average Salary per Year")

```

```{r}

# Maximum Salary per Year

sg_max <- sunshine_data %>%
  group_by(Calendar.Year) %>%
  summarise(entries=max(Salary.Paid)) %>%
  data.frame()

ggplot(data=sg_max, aes(x=Calendar.Year, y=entries)) +
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=-90,hjust=1,vjust=0.5)) +
  xlab("Year") +
  ylab("Maximum Salary") +
  ggtitle("Maximum Salary per Year")

```


